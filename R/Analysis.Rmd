---
title: "Eike Analysis"
output: html_notebook
---

First loading all packages and data...


```{r}
library('openxlsx')
library('dplyr')
library('ggplot2')
library('reshape2')
data.path <- '../data/'

raw.data <- read.xlsx(paste0(data.path,'AVM_DSA_Update_EPIE_DBER.xlsx'),sheet = 1)

#kick out Nan columns
clean.data <- raw.data[,-c(1,2,3,4,5,8,9,10,11,12,13,19,22,30,33,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,76,77)]


```

Originially 77 variables only 48 remain, clean for nan. Now we plot the correlation matrix 

```{r, echo=TRUE}
write.csv(clean.data, file = paste0(data.path,'Clean_data.csv'))

```



```{r, echo=TRUE}
library('caret')
library('corrplot')

new.data <- read.csv(paste0(data.path,'Cleaned_data_from_Python.csv'))

data.cor <- cor(new.data,use = 'complete.obs')
png('CorPlot.png', width = 2000, height = 2000)
corrplot(data.cor,method = 'circle')
dev.off()

tmp <- findCorrelation(data.cor,cutoff = 0.8)

filtered.data <- new.data[,-c(tmp)]

data.cor <- cor(filtered.data,use = 'complete.obs')
png('CorPlot_clean.png', width = 2000, height = 2000)
corrplot(data.cor,method = 'circle')
dev.off()


```


```{r}
fit <- lm(`Volume.of.Hemorrhage..ml.` ~ ., data = filtered.data)
summary(fit)
```

```{r}
fit.one <- lm(`Volume.of.Hemorrhage..ml.` ~ `Report..Smaller...0.no..1.yes`, data = filtered.data)
summary(fit.one)

```

```{r}

library('ggplot2')
library('partykit')


ggplot(data = clean.data, aes(y = `Volume.of.Hemorrhage.(ml)`, x = `2nd.DSA.Venous.drainage;.0=superficial;.1=deep`)) + 
         geom_point() + 
          geom_smooth(method = lm)

clean.data.num <- sapply(clean.data,FUN = as.numeric)

clean.data.v2 <- as.data.frame(clean.data.num)


library('rpart')

fit.tree <- rpart(data = clean.data.v2, `Volume.of.Hemorrhage.(ml)` ~ .,  method = 'anova', control = rpart.control(cp = 0.003))

plot(as.party(fit.tree))

```






